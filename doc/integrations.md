This document is meant to provide a brief overview of the technical aspects of integrating
with various event providers.

# eventbrite.com


## Web Navigation

  TODO

## Event Extraction

### Embedded [OK]

- the embedded data comes in two flavors 

**aggregate json object**
`
window.__SERVER_DATA__ = {
                "app_name": "discover",
                "search_data": {
                    "events": {
                        "pagination": {
                            "object_count": 10000,
                            "page_count": 49,
                            "page_number": 1,
                            "page_size": 20,
                            "continuation": "eyJwYWdlIjoyfQ"
                        },
                        "results": [{
                            "id": "721239024337",
                            "eventbrite_event_id": "721239024337"
                            ...
                            }]
                        },
`
this has the added benefit of revealing the paginated response

**Schema Event island (for google caching)**

`<script type="application/ld+json"></script>`


### Ajax [OK]

there are two ajax requests that have responses containing event data.
One of them is promotional (as the name would imply)

https://www.eventbrite.com/api/v3/promoted/events

https://www.eventbrite.com/api/v3/destination/search/

this json response has a similar structure to the embedded json above with the added bonus that
it is purely json and not a script tag within an html document

### A common solution

as both the embedded and ajax responses follow the same json format we can collect all ids
by casting a wide net with this regex.

`Pattern pat = Pattern.compile("(?<=eventbrite_event_id\\\\\":\\\\\").*?(?=\\\\\",\\\\\"start)"); //what an ungodly creation`

note, this wide net quickly becomes a bottleneck when eventbrite has many pages.


## Special Considerations


eventbrite.com has a developer API that is freely availble.The one caveat is that
you can not use this API to discover events. However, once you have obtained event IDs all event 
data is easily retrieved from the API. 

eventbrite.com exposes a geographical window search through query parameters that make it
easy to scrape since we don't have to worry about reverse geocoding.

## Remarks

- Currently Implementation for web navigation locates numbers in the markup to determine how
  many pages are available. It has been determined that the json in the markup exposes the pagination
  information.

- It seems that all of the initial event data is in the markup. So the API could be bypassed.

- Currently event id discovery is done with a regex over the whole network archive, but we
  really only need to search /events ands the initial url


# meetup.com


## Web Navigation


  TODO
 
 
## Event Extraction


meetup.com embeds intial event data in the HTML document generated by hitting the target url.
As you scroll down the page to see more requests the page uses ajax to request more event data.


### Embedded [OK]


The embedded data is in the form of **Schema**. It exists within a pair of 
`<script type=\"application/ld+json\"></script>`
tags within the document

- the document contains several scripts of type `ld+json` , only one is preceeded with `<link rel="dns-prefetch" href="https://www.googletagmanager.com"/>`

### Ajax [OK]

meetup.com loads additional results by executing ajax against there api `https://www.meetup.com/gql`

The ajax responses returns event data in the form of **GraphQL**.
Note : this data exists as an array belonging to a parent object.
The ***jq*** for this data would be `'.' | .data.rankedEvents.edges`

here is a sample event node for reference

```json
"node": {
  "id": "296140306",
  "title": "Spriing Lake Walk and ITALIAN Festival and Art Walk in Town",
  "dateTime": "2023-09-23T12:00-04:00",
  "endTime": "2023-09-23T14:00-04:00",
  "description": "We will take a walk past the lake and nice homes and then go to the Italian Festival in town .There will be music, dancing and food.IT's All Free except the food..The weather is said to be Sunny and in the 70's.We will meet at the train station parking lot at 12PM,off Warren Ave,free parking.The parking lot is across the street from Eagan's store.",
  "duration": "PT2H",
  "timezone": "America/New_York",
  "eventType": "PHYSICAL",
  "currency": "USD",
  "images": [],
  "venue": {
    "id": "26934760",
    "address": "Railroad Avenue",
    "neighborhood": null,
    "city": "Spring Lake",
    "state": "NJ",
    "country": "us",
    "lat": 40.150494,
    "lng": -74.03531,
    "zoom": 15,
    "name": "Spring Lake",
    "radius": 500,
    "__typename": "Venue"
  },
  "onlineVenue": null,
  "isSaved": false,
  "eventUrl": "https://www.meetup.com/monmouth-ocean-county-nj-green-singles-social-group/events/296140306",
  "group": {
    "id": "851192",
    "slug": "Monmouth-Ocean-County-NJ-Green-Singles-Social-Group",
    "isPrivate": false,
    "isOrganizer": false,
    "isNewGroup": false,
    "name": "Monmouth-Ocean County NJ Green Singles Social Group",
    "urlname": "Monmouth-Ocean-County-NJ-Green-Singles-Social-Group",
    "timezone": "America/New_York",
    "link": "https://www.meetup.com/monmouth-ocean-county-nj-green-singles-social-group",
    "city": "Red Bank",
    "state": "NJ",
    "country": "us",
    "groupPhoto": {
      "id": "450060820",
      "baseUrl": "https://secure-content.meetupstatic.com/images/classic-events/",
      "source": "https://secure.meetupstatic.com/photos/event/3/3/4/highres_450060820.jpeg",
      "__typename": "Image"
    },
    "__typename": "Group"
  },
  "going": 7,
  "maxTickets": 20,
  "tickets": {
    "count": 7,
    "edges": [
      {
        "node": {
          "id": "1970842425",
          "user": {
            "id": "3062719",
            "name": "Tim",
            "memberPhoto": {
              "id": "103938042",
              "baseUrl": "https://secure-content.meetupstatic.com/images/classic-member/",
              "source": null,
              "__typename": "Image"
            },
            "__typename": "User"
          },
          "__typename": "Ticket"
        },
        "__typename": "EventTicketsEdge"
      },
      {
        "node": {
          "id": "1970842427",
          "user": {
            "id": "13649843",
            "name": "brian",
            "memberPhoto": {
              "id": "295102796",
              "baseUrl": "https://secure-content.meetupstatic.com/images/classic-member/",
              "source": null,
              "__typename": "Image"
            },
            "__typename": "User"
          },
          "__typename": "Ticket"
        },
        "__typename": "EventTicketsEdge"
      },
      {
        "node": {
          "id": "1970847117",
          "user": {
            "id": "149875932",
            "name": "Pat",
            "memberPhoto": {
              "id": "310391108",
              "baseUrl": "https://secure-content.meetupstatic.com/images/classic-member/",
              "source": null,
              "__typename": "Image"
            },
            "__typename": "User"
          },
          "__typename": "Ticket"
        },
        "__typename": "EventTicketsEdge"
      }
    ],
    "__typename": "EventTicketsConnection"
  },
  "isAttending": false,
  "rsvpState": "JOIN_OPEN",
  "__typename": "Event",
  "isNewGroup": false,
  "covidPrecautions": {
    "venueType": "OUTDOORS",
    "__typename": "CovidPrecautions"
  }
},
```

AFAIK, this data format is local to meetup.com, unlike the **Schema** that allevents.in uses

## Special Considerations


meetup searches are rooted in a locality, but you can set a radius of exploration given that locality.
This makes it similar to eventbrite, but with the need to reverse geocode.


# allevents.in
 

## Web Navigation


we can find events within a named locality by manipulating this URL

`https://allevents.in/<locality>/all`

ex.

`https://allevents.in/brooklyn/all`

when localities exist within several regions we can get data for the
intended region by appendeding a region suffix.

`https://allevents.in/jackson-nj/all`
`https://allevents.in/jackson-ms/all`

when a region suffix is used, the  user gets redirected 
to a url sans suffix, but returns the correct data.
(I presume headers are set during the redirect to get the appropriate response)


allevents.in has a view more button once you scroll down the current event grid.


```
<a href="https://allevents.in/asbury%20park/all?page=5" id="show_more_events" class="mb20 btn-show-more"> View More </a>
```

clicking this button pulls the events into the browser session (through ajax)

alternatively, we can use the information in the head to navigate.
Going to these links directly creates a new page, but with a different data set.
Navigating to these pages individually would be preferrable because it can 
be distribuited in the future.

```
<head>
  <link rel="next" href="https://allevents.in/asbury%20park/all?page=2">
  <link rel="prev" href="https://allevents.in/asbury%20park/all?page=1">
</head>
```

the above is not always present in the head, so implementation is using the anchor

some localities are not supported. `asbury%20park` works but `wall%township` does not.
if unsupported it will return `404`


## Event Extraction


### Embedded [OK]


The embedded data is in the form of **Schema**.
It exists within a pair of 

  `<script type=\"application/ld+json\"></script>` 
  
tags within the document.

- this data does not fully represent the underlying event
  - Start/End Datetime is missing time component
  - Description is absent


## Special Considerations

allevents.com only exposes locality based searches. My API is structured around regional,
radius based searching. Currently, when scanning against allevents, we just scan the locality
that the geo coordinate maps to. In the future, this could be expanded and a utility can be made
to translate ( Radius, GeoCoordinate ) -> List<Locality> , then we can invoke a scan for each locality
in the region.

the embedded event Schema is incomplete and as a result, some data is spoofed.

